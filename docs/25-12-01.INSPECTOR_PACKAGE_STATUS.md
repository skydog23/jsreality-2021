# Inspector Package Status

_Last updated: 2025-12-01_

## Overview

The inspector stack (`src/core/inspect`) provides the browser-native replacement for the old jReality Navigator/Inspector. It renders a SceneGraph tree, property panel, and optional statistics pane, and is intended to be driven via plugins (see `SceneGraphInspectorPlugin`).

Key submodules:

- `SceneGraphInspector` / `TabbedInspector` orchestrate the UI using the managers below. Both expose `setRoot`, `refresh`, and `dispose`.
- `UIManager` builds the DOM and splitter, and now relies on `InspectorStylesheetManager` plus `dispose()` to remove document-level listeners.
- `TreeViewManager` renders inspector nodes produced by `SceneGraphTreeModel` descriptors, preserving expand/selection state while keeping DOM code separate from traversal logic.
- `PropertyPanelManager` leverages schema descriptors (`PropertySchemas`) for SceneGraphComponents, cameras, and geometry counts, while still handling transformations and shader nodes via `ShaderPropertyManager`.
- `InspectorHost` is the public controller used by plugins to mount/unmount inspectors cleanly.

## Plugin Integration

- `SceneGraphInspectorPlugin` instantiates `InspectorHost` and listens for `scene:changed` events.
- `ViewerEventBridge` (new) propagates viewer-level events (`contentChanged`, `viewerChanged`, `cameraChanged`) onto the plugin `EventBus` as `scene:changed`, `viewer:changed`, and `camera:changed`. Combined with the wildcard-aware event bus, this gives other plugins access to the same signals.
- `DisposableCollection` (in `core/util`) underpins cleanup for the bridge and future long-lived helpers.

## Current Behaviors

- Splitter drag handlers, injected styles, and plugin-managed inspectors now implement `dispose()` to prevent lingering global listeners.
- Tree nodes carry descriptive metadata (icon, label, type) so future UIs (React, etc.) can reuse the descriptors without DOM coupling.
- Shader editing still flows through `ShaderPropertyManager`, ensuring EffectiveAppearance remains canonical.
- Rendering callbacks bubble up through `InspectorHost` to whichever plugin/viewer uses the inspector (`SceneGraphInspectorPlugin`, `TabbedInspector`, or custom hosts).

## Known Gaps / Future Work

- Selection synchronization is not yet implemented. To mirror the original Navigator, the event bridge should surface selection events and the inspector should respond.
- Inspector UI state (expanded nodes, splitter positions, tab selection) is not persisted; optional preference hooks could use the new disposable infrastructure.
- Some debug logging remains in `TreeViewManager` (shader-node click traces). Remove or guard behind `DEBUG` when behavior stabilizes.
- Schema coverage is partialâ€”by default only component and camera basics plus geometry counts are described. Add more descriptors as new node types are exposed.
- No automated tests exist for tree/property generation. Consider writing unit tests before major refactors.

Use this document as a reference when extending the inspector or debugging plugin integrations. Update the timestamp above when significant changes land.

