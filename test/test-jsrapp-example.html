<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSRApp Example</title>
    <link rel="icon" type="image/png" href="../src/assets/images/icons/fav_icon.png">
    <!-- Load MathJS as a classic script into globalThis.math -->
    <script src="./vendor/mathjs/math.js"></script>
    <script type="importmap">
        {
          "imports": {
            "mathjs": "./vendor/mathjs/mathjs-bridge.js"
          }
        }
        </script>
    <style>
        :root {
            --canvas-padding: 0px; /* Change this to adjust padding around canvas */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: #cccccc;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: #2d2d2d;
            padding: 16px;
            border-bottom: 1px solid #3e3e3e;
        }

        .header h1 {
            margin: 0 0 8px 0;
            font-size: 24px;
            color: #ffffff;
        }

        .header p {
            margin: 0;
            color: #858585;
            font-size: 14px;
        }

        .viewer-container {
            flex: 1;
            display: flex;
            align-items: stretch;
            justify-content: stretch;
            background: #252526;
            padding: var(--canvas-padding);
            overflow: hidden;
            min-height: 0;
            position: relative;
        }

        .viewer-container > * {
            flex: 1 1 auto;
            min-width: 0;
            min-height: 0;
        }

        .info {
            background: #2d2d2d;
            padding: 12px 16px;
            border-top: 1px solid #3e3e3e;
            font-size: 12px;
            color: #858585;
        }
    </style>
</head>
<body>
    <div class="viewer-container" id="viewer-container"></div>

    <div class="info" id="info">
        Initializing...
    </div>

    <script type="module">
        // ============================================================================
        // CONFIGURATION: can be overridden via URL query parameters
        // 
        // Example:
        //   test-jsrapp-example.html?module=../src/app/examples/TestGeometryApp.js&class=TestGeometryApp
        //
        // If no parameters are provided, we fall back to TestToolApp.
        // ============================================================================
        const params = new URLSearchParams(window.location.search);
        const APP_CONFIG = {
            modulePath: params.get('module') || '../src/app/examples/TestToolApp.js',
            className: params.get('class') || 'TestToolApp',
            title: params.get('title') || null,
            subtitle: params.get('subtitle') || null,
        };

        // Get container element (JSRApp/JSRViewer manage their own canvases)
        const container = document.getElementById('viewer-container');
        const info = document.getElementById('info');
        const pageTitle = document.getElementById('page-title');
        const pageSubtitle = document.getElementById('page-subtitle');


        try {
            info.textContent = `Loading ${APP_CONFIG.className}...`;
            
            // Dynamically import the module
            const module = await import(APP_CONFIG.modulePath);
            
            // Get the class from the imported module
            const AppClass = module[APP_CONFIG.className];
            if (!AppClass) {
                throw new Error(`Class "${APP_CONFIG.className}" not found in module "${APP_CONFIG.modulePath}"`);
            }
            
            info.textContent = `Creating ${APP_CONFIG.className} instance...`;
            
            // Create app instance using the dynamically loaded class
            // Layout manager + viewers will fill the container automatically
            const app = new AppClass({ container });
            
            // JSRApp registers plugins asynchronously; wait for them before calling display().
            if (app && typeof app.whenReady === 'function') {
                info.textContent = `${APP_CONFIG.className} created. Waiting for plugins...`;
                await app.whenReady();
            }

            info.textContent = `${APP_CONFIG.className} ready. Calling display()...`;
            
            // Call display() method to render
            app.display();
            
            info.textContent = '✓ Display rendered successfully! Canvas will auto-resize.';
            
            // Expose app globally for debugging
            window.testApp = app;
            console.log(`${APP_CONFIG.className} instance available as window.testApp`);
            console.log('Viewer:', app.getViewer());
            console.log('Tool System:', app.getToolSystem());
            console.log('Scene Root:', app.getViewer().getSceneRoot());
            const bounds = container.getBoundingClientRect();
            console.log('Viewer container size:', bounds.width, 'x', bounds.height);
            
        } catch (error) {
            console.error(`Error creating ${APP_CONFIG.className}:`, error);
            info.textContent = '✗ Error: ' + error.message;
            info.style.color = '#ff6b6b';
        }
    </script>
</body>
</html>

