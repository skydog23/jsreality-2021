<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Resize Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1e1e1e;
            color: #cccccc;
        }
        
        h1 {
            color: #ffffff;
        }
        
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #2d2d2d;
            border-radius: 4px;
        }
        
        .controls button {
            padding: 8px 16px;
            margin-right: 10px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .controls button:hover {
            background: #005a9e;
        }
        
        .info {
            margin-top: 10px;
            font-size: 12px;
            color: #858585;
        }
        
        .container {
            width: 800px;
            height: 600px;
            background: #252526;
            border: 2px solid #3e3e3e;
            border-radius: 4px;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .container.small {
            width: 400px;
            height: 300px;
        }
        
        .container.large {
            width: 1200px;
            height: 800px;
        }
    </style>
</head>
<body>
    <h1>üîç SVG Viewer Resize Test</h1>
    
    <div class="controls">
        <button id="small-btn">Small (400√ó300)</button>
        <button id="medium-btn">Medium (800√ó600)</button>
        <button id="large-btn">Large (1200√ó800)</button>
        <div class="info" id="size-info">Current container size: 800√ó600</div>
        <div class="info" id="svg-info">SVG dimensions: Checking...</div>
    </div>
    
    <div class="container" id="svg-container"></div>

    <script type="module">
        import { SVGViewer } from '../src/core/viewers/SVGViewer.js';
        import { SceneGraphComponent } from '../src/core/scene/SceneGraphComponent.js';
        import { SceneGraphPath } from '../src/core/scene/SceneGraphPath.js';
        import { Camera } from '../src/core/scene/Camera.js';
        import { Transformation } from '../src/core/scene/Transformation.js';
        import { IndexedLineSet } from '../src/core/scene/IndexedLineSet.js';
        import { Appearance } from '../src/core/scene/Appearance.js';
        import { Color } from '../src/core/util/Color.js';
        import * as CommonAttributes from '../src/core/shader/CommonAttributes.js';
        import { MatrixBuilder } from '../src/core/math/MatrixBuilder.js';
        import { toDataList } from '../src/core/scene/data/DataUtility.js';
        
        // Create a simple test scene
        const sceneRoot = new SceneGraphComponent('root');
        
        // Add appearance
        const appearance = new Appearance('rootAppearance');
        appearance.setAttribute(CommonAttributes.BACKGROUND_COLOR, new Color(240, 240, 240));
        sceneRoot.setAppearance(appearance);
        
        // Create camera
        const cameraComponent = new SceneGraphComponent('cameraNode');
        const camera = new Camera();
        camera.setName('camera');
        camera.setFieldOfView(60);
        camera.setNear(-5);
        camera.setFar(5);
        camera.setPerspective(false);
        cameraComponent.setCamera(camera);
        
        const cameraTransform = new Transformation();
        const cameraMatrix = MatrixBuilder.euclidean().translate(0, 0, -1).getArray();
        cameraTransform.setMatrix(cameraMatrix);
        cameraComponent.setTransformation(cameraTransform);
        
        sceneRoot.addChild(cameraComponent);
        
        // Create camera path
        const cameraPath = new SceneGraphPath();
        cameraPath.push(sceneRoot);
        cameraPath.push(cameraComponent);
        cameraPath.push(camera);
        
        // Create some geometry - a simple grid
        const gridComponent = new SceneGraphComponent('grid');
        const gridGeometry = new IndexedLineSet();
        
        const gridVertices = [];
        const gridIndices = [];
        const gridSize = 2;
        const gridDivisions = 10;
        const step = gridSize / gridDivisions;
        
        // Horizontal lines
        for (let i = 0; i <= gridDivisions; i++) {
            const y = -gridSize / 2 + i * step;
            const startIdx = gridVertices.length;
            gridVertices.push([-gridSize / 2, y, 0, 1]);
            gridVertices.push([gridSize / 2, y, 0, 1]);
            gridIndices.push([startIdx, startIdx + 1]);
        }
        
        // Vertical lines
        for (let i = 0; i <= gridDivisions; i++) {
            const x = -gridSize / 2 + i * step;
            const startIdx = gridVertices.length;
            gridVertices.push([x, -gridSize / 2, 0, 1]);
            gridVertices.push([x, gridSize / 2, 0, 1]);
            gridIndices.push([startIdx, startIdx + 1]);
        }
        
        gridGeometry.setVertexCountAndAttributes(
            gridVertices.length,
            toDataList(gridVertices)
        );
        gridGeometry.setEdgeCountAndIndices(gridIndices.length, toDataList(gridIndices));
        
        gridComponent.setGeometry(gridGeometry);
        
        const gridAppearance = new Appearance('gridAppearance');
        gridAppearance.setAttribute(CommonAttributes.LINE_SHADER + '.' + CommonAttributes.DIFFUSE_COLOR, new Color(100, 100, 100));
        gridAppearance.setAttribute(CommonAttributes.LINE_SHADER + '.' + CommonAttributes.TUBE_RADIUS, 0.01);
        gridComponent.setAppearance(gridAppearance);
        
        sceneRoot.addChild(gridComponent);
        
        // Create a circle in the center
        const circleComponent = new SceneGraphComponent('circle');
        const circleGeometry = new IndexedLineSet();
        
        const circleVertices = [];
        const circleIndices = [];
        const numSegments = 64;
        const radius = 0.5;
        
        for (let i = 0; i < numSegments; i++) {
            const angle = (i / numSegments) * Math.PI * 2;
            circleVertices.push([
                Math.cos(angle) * radius,
                Math.sin(angle) * radius,
                0,
                1
            ]);
        }
        
        for (let i = 0; i < numSegments; i++) {
            circleIndices.push([i, (i + 1) % numSegments]);
        }
        
        circleGeometry.setVertexCountAndAttributes(
            circleVertices.length,
            toDataList(circleVertices)
        );
        circleGeometry.setEdgeCountAndIndices(circleIndices.length, toDataList(circleIndices));
        
        circleComponent.setGeometry(circleGeometry);
        
        const circleAppearance = new Appearance('circleAppearance');
        circleAppearance.setAttribute(CommonAttributes.LINE_SHADER + '.' + CommonAttributes.DIFFUSE_COLOR, new Color(0, 150, 255));
        circleAppearance.setAttribute(CommonAttributes.LINE_SHADER + '.' + CommonAttributes.TUBE_RADIUS, 0.03);
        circleComponent.setAppearance(circleAppearance);
        
        sceneRoot.addChild(circleComponent);
        
        // Create SVG viewer
        const container = document.getElementById('svg-container');
        const svgViewer = new SVGViewer(container, {
            width: 800,
            height: 600,
            autoResize: true
        });
        
        svgViewer.setSceneRoot(sceneRoot);
        svgViewer.setCameraPath(cameraPath);
        svgViewer.render();
        
        console.log('‚úì SVG viewer created with autoResize enabled');
        
        // Function to update info display
        function updateInfo() {
            const containerRect = container.getBoundingClientRect();
            const svgElement = svgViewer.getViewingComponent();
            const svgWidth = svgElement.getAttribute('width');
            const svgHeight = svgElement.getAttribute('height');
            
            document.getElementById('size-info').textContent = 
                `Current container size: ${Math.round(containerRect.width)}√ó${Math.round(containerRect.height)}`;
            document.getElementById('svg-info').textContent = 
                `SVG dimensions: ${svgWidth}√ó${svgHeight}`;
        }
        
        // Update info on load
        updateInfo();
        
        // Watch for container size changes
        const resizeObserver = new ResizeObserver(() => {
            updateInfo();
        });
        resizeObserver.observe(container);
        
        // Button handlers
        document.getElementById('small-btn').addEventListener('click', () => {
            container.className = 'container small';
            console.log('Container resized to small (400√ó300)');
        });
        
        document.getElementById('medium-btn').addEventListener('click', () => {
            container.className = 'container';
            console.log('Container resized to medium (800√ó600)');
        });
        
        document.getElementById('large-btn').addEventListener('click', () => {
            container.className = 'container large';
            console.log('Container resized to large (1200√ó800)');
        });
        
        console.log('‚úì Resize test ready');
        console.log('Click the buttons above to resize the container and verify that the SVG updates automatically');
    </script>
</body>
</html>

